#!/usr/bin/env bash

#TODO convert this to python
#keep a symlink / symlinkd dest pair list

#create necessary outide this repo so that main repo can use this subrepo

set -u # error on undefined variable
set -e # stop execution if one command returns != 0

FILE_EXISTS_MESSAGE="FILE ALREADY EXISTS. INSTALLATION ABORTED:"

#basename of current directory
CUR_DIR_BNAME="$( basename "$( pwd )" )"

#shared files that will be symlinked into the repo root with the same basename
FS_LN=( makefile .gitignore shared.sty shared-presentation.sty )

#check that all targets symlink names are free
for F in "${FS_LN[@]}" ; do
    if [ -e ../"$F" ]; then
        echo "$FILE_EXISTS_MESSAGE $F"
        exit 1
    fi
done

#TODO get rid of this, include it in the more general symlik / symlik dest pairs method
if [ -e "../src/.gitignore" ]; then
    echo "$FILE_EXISTS_MESSAGE src/.gitignore"
    exit 1
fi

cd ..

#make the symlinks
for F in "${FS_LN[@]}"; do
    ln -s "$CUR_DIR_BNAME"/"$F" "$F"
done

#make the symlinks
mkdir -p src
cd src
ln -s ../"$CUR_DIR_BNAME"/.gitignore-exts .gitignore

echo 'INSTALLATION FINISHED. CONSIDER ADDING GENERATED FILES TO PROJECT WITH: `git add`'
exit 0
